"use strict";if(window.hasOwnProperty("INVEN")&&$.isPlainObject(window.INVEN)||(window.INVEN={}),INVEN.hasOwnProperty("IGCCS")&&"object"==typeof INVEN.IGCCS&&INVEN.IGCCS.constructor!==Object&&INVEN.IGCCS.constructor.prototype.hasOwnProperty("__provider__")&&"INVEN"===INVEN.IGCCS.constructor.prototype.__provider__||(INVEN.IGCCS={},function(t){var e=function(t,e){alert(e)},n=!1,a=!1,o=!1,i=!1,r="",s={_token:"",target1:0,target2:0,target3:0,editor:{},sortButtons:{},moreButton:{},myimageCache:{},lazyLoadingTargets:t(),listLading:t(),doing:{write:{},modify:{},update:{},state:{},list:{},vote:{},translate:{google:{},suggest:{},view:{}},report:{},imageupload:!1,mySuggestion:{},mySuggestionDelete:{}},write:function(n,a){var o=t(this),i=o.is("[data-default-form]")?0:o.closest("li").attr("id").replace(/[^\d]+/g,""),d="/comments/"+s.target1+"/"+s.target2+"/"+s.target3+"/"+i,l={_token:s._token},c=t("#IGCCS-modal-captcha");if(t.isPlainObject(a))t.extend(l,a);else if(c.length){var m=o.data("editor").getComment().match(/\/\/(?!(\w+\.)?(invenglobal\.com|tenor\.com))\w+\.\w+[^\/]+/gi);if(m&&m.length)return c.on("comment.captcha.error",function(e,n){"after_verify"==n?alert("Failed to load captcha code.\nPlease press the change button after a while."):(alert("Failed to load captcha code.\nPlease try again later."),t(this).triggerHandler("comment.modal.hide"))}).on("comment.modal.submit",function(t,e){s.write.call(n.target,n,{captchas:e})}).triggerHandler("comment.modal.show",[Math.min(m.length,10)]),!1}if(o.data("editor").sync(),o.data("editor").isEmpty())return e(0,"Please enter your comment."),!1;if(s.doing.write.hasOwnProperty(d))return e(0,"Saving the previous comments. Please try again later."),!1;var g=o.find("[type=radio][name=team]"),u=null;if(g.length&&0==(u=g.filter(":checked")).length)return e(0,"You must select a team."),!1;s.doing.write[d]=!0,o.parent().addClass("IGCCS-loading"),o.ajaxSubmit({url:d,clearForm:!0,data:l,dataType:"json",type:"POST",uploadProgress:function(t,e,n,a){}}),o.data("jqxhr").done(function(e){var n=t(e.cmt);if(n.find("div.doc > div.IGCCS-content > blockquote.quote > span.quotation-source").append('<button class="btn_toggle"></button>'),s.addLazyLoadingTarget(n),o.is("[data-default-form]"))t("#IGCCS_list")["new"==r?"prepend":"append"](n.addClass("new-commnet")),o.data("editor").empty();else{var a=t("#IGCCS_ID_"+i);if(a.length){var d=a.closest("li.cmt-parent").children("ul.reply");d.length||(d=t('<ul class="reply"></ul>').appendTo(a.closest("li.cmt-parent"))),d.append(n)}o.closest("li").find('button[data-comment-action="reply"]').removeData("editor"),o.data("editor").destroy(!0)}var l=t(".IGCCS-comment_count strong"),m=+l.text()+1;if(l.text(m),t(".IGCCS-comment").attr("data-cmt-count",m),u&&u.prop("checked",!0),t("html,body").animate({scrollTop:n.offset().top},0,function(){s.lazyLoading(n)}),"total_cnt"in e&&"team_a_cnt"in e&&"team_b_cnt"in e){var g=Math.round(e.team_a_cnt/e.total_cnt*100),h=100-g,p=t(".IGCCS-comment-agreement"),f=t(".IGCCS-comment-opposition");p.css("width",g+"%").find(".side-per").text(e.team_a_cnt+" ("+g+"%)"),f.css("width",h+"%").find(".side-per").text(e.team_b_cnt+" ("+h+"%)"),g>h?(p.removeClass("IGCCS-comment-zindex"),f.addClass("IGCCS-comment-zindex")):g<h?(p.addClass("IGCCS-comment-zindex"),f.removeClass("IGCCS-comment-zindex")):(p.removeClass("IGCCS-comment-zindex"),f.removeClass("IGCCS-comment-zindex"))}c.filter(".act").triggerHandler("comment.modal.hide")}).fail(function(t){var n=t.getResponseHeader("x-captcha-error");switch(e(0,JSON.parse(t.responseText)||"Unknown error occurred!"),n){case"count":c.triggerHandler("comment.captcha.count",[t.getResponseHeader("x-captcha-count")]);break;case"not_found":case"invalid":c.triggerHandler("comment.captcha.remove",[t.getResponseHeader("x-captcha-random"),n])}}).always(function(){delete s.doing.write[d],o.parent().removeClass("IGCCS-loading"),o=null,d=null,i=null,s.myimageCache={}})},state:function(n){var a=t(this),o=a.closest("li[id]"),i=o.attr("id").replace(/^.+?_(\d+)$/,"$1"),r=a.attr("data-comment-action").toLowerCase(),d=t.trim(a.text()).toLowerCase();return!!confirm("Are you sure you want to "+d+" this comment?")&&(s.doing.state.hasOwnProperty(i)?(e(0,"The requested operation is being processed. Please try again later."),!1):(s.doing.state[i]=!0,o.children("div.item").addClass("IGCCS-loading"),void t.ajax({type:"PATCH",dataType:"json",url:"/comments/"+i+"/"+("delete"==r?"N":"B"),data:{_token:s._token,target1:s.target1,target2:s.target2,target3:s.target3}}).done(function(n){if(n.state&&n.cidx){var a=t("#IGCCS_ID_"+n.cidx).children("div.item"),i=t("#BEST_IGCCS_ID_"+n.cidx);a=i.length?a.add(i):a,"N"===n.state?(e(0,"Comment has been deleted."),n.remove?o.hasClass("cmt-parent")&&o.children(".reply").length?(o.children(".item").find(".doc").children().not(".name,.btn_toggle").remove(),o.children(".item").find(".doc .name").after('<p class="view-blind-comment">[ Deleted Comments ]</p>')):o.remove():(a.find(".doc").addClass("deleted"),a.find(".IGCCS-content").addClass("blind").before('<button class="view-blind-comment">[ Deleted Comments ]</button>')),a.find("[data-comment-action=delete]").text("Recover")):"Y"===n.state?(e(0,"Comment has been restored."),a.find("button.view-blind-comment").remove(),a.find(".doc").removeClass("deleted"),a.find(".IGCCS-content").removeClass("blind"),a.find("[data-comment-action=delete]").text("Delete")):"B"===n.state?(e(0,"Comment has been blined"),a.find(".IGCCS-content").addClass("blind").before('<button class="view-blind-comment">[ Blinded Comments ]</button>'),a.find("[data-comment-action=blind]").text("Unblind")):"UB"===n.state&&(e(0,"Comments are no longer hidden."),a.find(".IGCCS-content").removeClass("blind"),a.find("button.view-blind-comment").remove(),a.find("[data-comment-action=blind]").text("Blind"))}}).fail(function(t){alert(JSON.parse(t.responseText)||"Unknown error occurred!")}).always(function(){delete s.doing.state[i],o.children("div.item").removeClass("IGCCS-loading"),o=null,i=null})))},vote:function(n){if(!INVEN.IGCCS.auth())return!1;var a=t(this),o=a.closest("li[id]").attr("id").replace(/^.+?_(\d+)$/,"$1"),i=a.is(".btn_up")?"good":"bad",r=a.parent().find("button[disabled]");if(s.doing.vote.hasOwnProperty(o))return e(0,"The requested operation is being processed. Please try again later."),!1;if(r.length){if(!confirm('Are you sure you want to cancel "'+(a.parent().find("button[disabled]").is(".btn_up")?"Good":"Bad")+'" rating?'))return!1}else if(!confirm('Would you like to rate this comment "'+(i.charAt(0).toUpperCase()+i.slice(1))+'"?'))return!1;s.doing.vote[o]=!0,t.ajax({type:"POST",dataType:"json",url:"/comments/vote/"+o+"/"+i,data:{_token:s._token,target1:s.target1,target2:s.target2,target3:s.target3}}).done(function(e){if("object"==typeof e&&e.hasOwnProperty("id")&&e.hasOwnProperty("score")){var n=t("#BEST_IGCCS_ID_"+e.id+" > div.number,#BEST_IGCCS_ID_"+e.id+" > div.item > div.number,#IGCCS_ID_"+e.id+" > div.item > div.number");n.find("> p").text(e.score),"CANCEL"===e.type?n.find("button").prop("disabled",!1):(n.find("button."+("good"===i?"btn_up":"btn_down")).prop("disabled",!0),n.find("button."+("good"===i?"btn_down":"btn_up")).prop("disabled",!1))}}).fail(function(n){e(0,t.trim(JSON.parse(n.responseText).replace("[cmt-013]",""))||"Unknown error occurred!")}).always(function(){delete s.doing.vote[o],o=null,i=null})},more:function(n){var a=t("select#IGCCS-vs-team").val();if(n&&n.target&&"SELECT"!=n.target.nodeName&&n.preventDefault(),s.doing.list.hasOwnProperty("more"))return e(0,"Waiting for request response. Please try again later."),!1;var o=parseInt(s.moreButton.length?s.moreButton.attr("href").match(/\d+$/)[0]:1,10),i=t(n.target).is("button");s.doing.list.more=!0,i?s.listLading.addClass("active"):s.moreButton.addClass("active"),t.ajax({url:"/comments/"+s.target1+"/"+s.target2+"/"+s.target3+"/"+o,type:"GET",dataType:"json",data:{orderBy:r,filter:a}}).done(function(n){if(n&&n.hasOwnProperty("data")){if(!(n.data.length&&0!==n.next||(s.moreButton.hide(),n.data.length)))return;"new"!=r&&t("#IGCCS_list li.new-commnet").remove();var a=t(window);if(t.map(n.data,function(e){var n=t(e),o=t("#"+n.attr("id"));n.find("div.doc > div.IGCCS-content > blockquote.quote > span.quotation-source").append('<button class="btn_toggle"></button>'),s.addLazyLoadingTarget(n),a.width()<600&&n.find("a[data-lightbox]").each(function(){this.setAttribute("data-lightbox-mobile",this.getAttribute("data-lightbox")),this.removeAttribute("data-lightbox")}),o.length?(o.children("ul.reply").length||o.append('<ul class="reply"></ul>'),n.find("ul.reply > li").each(function(){var e=t(this);t("#"+e.attr("id")).length||t(this).appendTo(o.find("ul.reply"))}),o.find(".name .counts strong").text(o.find("ul.reply").children().length),n.remove(),n=null):t("#IGCCS_list").append(n)}),s.moreButton.length&&s.moreButton.attr("href","#load-more-"+(o+1)),s.lazyLoading(),i){var d=t(window).height(),l=t(window).scrollTop(),c=t("#IGCCS_list").offset().top;c-l>d/2&&t("html,body").animate({scrollTop:c-t("#header-wrap").height()},500)}}else e(0,"There was an error loading the comment list.")}).fail(function(t){e(0,JSON.parse(t.responseText)||"Unknown error occurred!")}).always(function(){delete s.doing.list.more,o=null,i?s.listLading.removeClass("active"):s.moreButton.removeClass("active")})},sort:function(e){var n=t(this);n.is(".act")||(s.sortButtons.removeClass("act"),n.addClass("act"),r=n.text().toLowerCase(),s.moreButton.show().attr("href","#load-more-1"),CommentEditor.cleanup(),t("#IGCCS_list").html(""),s.lazyLoadingTargets=t(),s.more(e))},fold:function(){t(this).closest("li").toggleClass("cmt-close")},foldQuote:function(e){var n=t(this).closest(".quote");if(n.hasClass("fold-quote"))n.children(".replacetext").remove();else{var a="";n.find("img,video").length?a="[Cited image included]":a||(a=n.text().substr(0,250)),n.prepend('<div class="replacetext">'+a+"&nbsp;</div>")}n.toggleClass("fold-quote")},googleTranslate:function(){try{var n=t(this).closest("li").attr("id").match(/\d+$/)[0];if(s.doing.translate.google.hasOwnProperty(n))return void(1===s.doing.translate.google[n]?e(0,"Waiting for request response. Please try again later."):e(0,"Your translation request has already been completed."));s.doing.translate.google[n]=1;var a=t('<div class="content-translate IGCCS-loading" data-provider="google-translate"></div>'),o=t("#BEST_IGCCS_ID_"+n+" .doc, #IGCCS_ID_"+n+" > div.item").find(".IGCCS-content");o.siblings(".content-translate").remove(),o.after(a),t.ajax({url:"/comments/translate/google/"+n,type:"GET",dataType:"json",data:{target1:s.target1,target2:s.target2,target3:s.target3}}).done(function(t){if(t&&t.data&&t.cidx){s.doing.translate.google[n]=2;var i,r=[];if(t.data.suggest){var d,l=t.data.suggest.length,c=0;for(r.push('<button class="translate-suggest-nickname hidden" data-provider="google-translate" data-cidx="'+n+'" data-tidx="0">Google Translate</button>');c<l;c++)d=t.data.suggest[c],r.push('<button class="translate-suggest-nickname" data-provider="'+d.memnick+'" data-cidx="'+n+'" data-tidx="'+d.tidx+'">'+d.memnick+"'s</button>")}var m='<a class="IGCCS-language-setting" href="'+(IGCCS_COMMENT_AUTH?"/user/view":"/comments/auth")+'"><img src="https://static.invenglobal.com/img/common/comments/tel.png"> Language setting</a>';i='<div class="translate-info">By <span class="provider-name">Google</span>'+(r.length?" (see more translations : "+r.join("")+")":"")+m+"</div>",o.siblings(".content-translate.IGCCS-loading").removeClass("IGCCS-loading").html('<div class="translate-text">'+t.data[0]+"</div>"+i),a.find("div.translate-info > button.translate-suggest-nickname:last").addClass("last")}else e(0,"Unknown error occurred!"),delete s.doing.translate.google[n]}).fail(function(t){e(0,JSON.parse(t.responseText)||"Unknown error occurred!"),delete s.doing.translate.google[n],a.remove(),a=null}).always(function(){n=null,a=null})}catch(t){e(0,"Wrong Access!")}},translateSuggestion:function(n){n.preventDefault();var a=t(this),o=a.closest("form"),i=t.trim(o.find("select").val().toLowerCase()),r=t.trim(o.find("textarea").val()),d=a.closest(".IGCCS-pop").data("cidx"),l=o.find("[name=idx]").val();d?(s.doing.translate.suggest[d]&&e(0,"Waiting for request response. Please try again later."),["en","ko"].indexOf(i)<0?e(0,"Language is invalid."):0!==r.length?(s.doing.translate.suggest.cidx=!0,t.ajax({type:"POST",dataType:"json",url:"/comments/translate/suggest/"+d,data:{_token:s._token,target1:s.target1,target2:s.target2,target3:s.target3,lang:i,content:r,idx:l}}).done(function(n){e(0,l?"Your suggestion has been updated.":"Your suggestion has been received."),t("#IGCCS-popup-bg").hide();t("#IGCCS-modal-trans-suggestion").removeClass("act");t("body").removeClass("lb-disable-scrolling")}).fail(function(t){alert(JSON.parse(t.responseText)||"Unknown error occurred!")}).always(function(){delete s.doing.translate.suggest[d],d=null})):e(0,"Please enter your suggestion.")):e(0,"Target comment is invalid.")},translateView:function(){var n=t(this),a=n.closest("div.content-translate"),o=a.attr("data-provider"),i=n.data("provider"),r=n.data("tidx"),d=n.data("cidx");if(o)if(a.data(o)||a.data(o,a.find("div.translate-text").html()),a.data(i))a.find("div.translate-text").html(a.data(i)),n.parent().find("button").removeClass("hidden last"),n.addClass("hidden"),n.parent().find("button:not(.hidden):last").addClass("last"),a.attr("data-provider",i).find("span.provider-name").text("google-translate"===i?"Google":i);else{if(s.doing.translate.view.hasOwnProperty(r))return void e(0,"Waiting for request response. Please try again later.");s.doing.translate.view[r]=!0,a.addClass("IGCCS-loading"),t.ajax({type:"GET",dataType:"json",url:"/comments/translate/suggest/"+d+"/"+r,data:{_token:s._token}}).done(function(t){t.content?(a.find("div.translate-text").html(t.content),n.parent().find("button").removeClass("hidden last"),n.addClass("hidden"),n.parent().find("button:not(.hidden):last").addClass("last"),a.attr("data-provider",i).find("span.provider-name").text("google-translate"===i?"Google":i)):e(0,"No data found.")}).fail(function(t){e(0,JSON.parse(t.responseText)||"Unknown error occurred!")}).always(function(){delete s.doing.translate.view[r],a.removeClass("IGCCS-loading"),r=null,a=null,n=null,i=null})}else e(0,"Wrong Access!")},suggestionDelete:function(){var n=t("#IGCCS-modal-trans-suggestion"),a=this.form,o=n.data("cidx"),i=t(a).find("[name=idx]").val();if(!s.doing.mySuggestionDelete[o]){if(!confirm("Are you sure to delete your suggestion?"))return;t.ajax({url:"/comments/translate/mysuggest/"+o+"/"+i,data:{_token:s._token},type:"DELETE"}).done(function(t){t.results?(alert("Your suggestion has been deleted."),n.find("[name=idx],[name=content]").val("").end().find(".cmt-btn-delete").hide()):alert("An error has occurred. Please try again.")}).fail(function(t){e(0,JSON.parse(t.responseText)||"Unknown error occurred!")}).always(function(){delete s.doing.mySuggestionDelete[o]})}},mySuggestion:function(n,a,o){s.doing.mySuggestion[n]||t.get("/comments/translate/mysuggest/"+n+"/"+a).done(function(t){o(t)}).fail(function(t){e(0,JSON.parse(t.responseText)||"Unknown error occurred!")}).always(function(){delete s.doing.mySuggestion[n]})},myImages:function(){if(s.doing.list.hasOwnProperty("myimage"))return e(0,"Waiting for request response. Please try again later."),!1;var n=t("#IGCCS-modal-insert-image").find("div.image-preview"),a=function(a){if(n.html(""),a.list&&a.list.length){for(var o,i=t("<ul/>"),r=t('<div class="my-image-list"></div>'),s=0,d=a.list.length;s<d;s++)o=a.list[s],i.append('<li><a class="'+("Y"==o.animate?"gif":"")+'" href="'+o.path+'" title="'+o.originalname+'" data-image="'+o.name+'"><img src="'+o.resizepath+'" alt=""></a>');n.append(r.append(i))}else a.list&&0===a.list.length?n.html("No images uploaded."):e(0,"No data found.")};t.isEmptyObject(s.myimageCache)?(s.doing.list.myimage=!0,n.addClass("IGCCS-loading"),t.ajax({type:"GET",dataType:"json",url:"/comments/my/images"}).done(function(t){s.myimageCache=t,a(t)}).fail(function(t){alert(JSON.parse(t.responseText)||"Unknown error occurred!")}).always(function(){delete s.doing.list.myimage,n.removeClass("IGCCS-loading"),n=null})):a(s.myimageCache)},showBlind:function(){t(this).next(".IGCCS-content").toggleClass("show")},reportComment:function(){var n=t(this),a=n.closest("form"),o=t.trim(a.find("select").val().toLowerCase()),i=t.trim(a.find("textarea.cmt-textarea").val()),r=n.closest(".IGCCS-pop").data("cidx");r?(s.doing.report[r]&&e(0,"Waiting for request response. Please try again later."),["offensive","spam","obscenity","aversion","etc"].indexOf(o)<0?e(0,"Report type is invalid."):("etc"===o&&0===i.length&&e(0,"Please enter the reason for the report."),s.doing.report.cidx=!0,t.ajax({type:"POST",dataType:"json",url:"/comments/report/"+r,data:{_token:s._token,target1:s.target1,target2:s.target2,target3:s.target3,type:o,content:i}}).done(function(n){e(0,"Your report has been received.\nIt may take some time for\nthe administrator to check and process it."),t("#IGCCS-popup-bg").hide();var a=t("#IGCCS-modal-report").removeClass("act");t("body").removeClass("lb-disable-scrolling"),a.find("select").val("").prop("value",""),a.find("textarea").val("")}).fail(function(t){alert(JSON.parse(t.responseText)||"Unknown error occurred!")}).always(function(){delete s.doing.report[r],r=null}))):e(0,"Target comment is invalid.")},myImageListWidth:function(){var e=t("#IGCCS-modal-insert-image").find("div.image-preview ul"),n=(e.find("li").length,0);e.length&&(e.find("li").each(function(){var e=t(this);n+=e.width()+parseFloat(e.css("margin-left"))+parseFloat(e.css("margin-right"))+parseFloat(e.css("padding-left"))+parseFloat(e.css("padding"))+parseFloat(e.css("border-left-width"))+parseFloat(e.css("border-right-width"))}),e.css("width",Math.ceil(n)))},commentScroll:function(e){if(!t(e.target).is('a,button,[data-role="button"],img,video,:has(>video)')&&!t(e.target).closest(".reply-editor-area").length){var n=t(this).closest("li").attr("id").match(/\d+$/),a=n?t("#IGCCS_ID_"+n[0]):null;a.length&&t("html,body").animate({scrollTop:a.offset().top},0)}},mobileControl:function(e){var n=t(this);if(t(document).off("click.mobile.controll"),!n.hasClass("open"))return t(".IGCCS-mobile-controll-btn.open",IGCCS).removeClass("open"),n.addClass("open"),t(document).on("click.mobile.controll",function(e){t(e.target).closest(".IGCCS-mobile-controll").length||t(".IGCCS-mobile-controll-btn.open",IGCCS).removeClass("open")}),!1;n.removeClass("open")},vsTeamSelect:function(e){s.moreButton.show().attr("href","#load-more-1"),t("ul#IGCCS_list").html(""),s.lazyLoadingTargets=t(),s.more(e)},addLazyLoadingTarget:function(t){this.lazyLoadingTargets=this.lazyLoadingTargets.add(t.find(".comment-doc-image"))},lazyLoading:function(){if(this.lazyLoadingTargets=this.lazyLoadingTargets.filter(":has(img[data-src]), :has(.comment-has-video)"),this.lazyLoadingTargets.length){var e=t(window).scrollTop(),n=t(window).height();this.lazyLoadingTargets.each(function(r,s){var d=t(s),l=Math.floor(d.offset().top),c=l-e,m=Math.max(100,Math.floor(d.outerHeight())),g=l+m-(e+n),u=m-(c<0?Math.abs(c):0)-(g>0?g:0);if(u>-50&&u<=n){var h=d.find("img,video");if(h.length)if((w=d.find(".comment-has-video.alt-poster")).length){o&&i||(w.data("poster",h),h.replaceWith(w.data("video")));var p=!1;(w.hasClass("play")||(p=w.hasClass("auto-play")))&&(w.find("video").get(0).play(),p&&w.addClass("play").removeClass("auto-play")),w.removeClass("alt-poster")}else if(h.is("img[data-src]")){var f="https://static.invenglobal.com"+h.attr("data-src"),v=h.is("[data-tenor-id]"),C=v;if(v)if(a){f="https://media.tenor.com/videos/"+h.attr("data-tenor-mp4")+"/mp4";var b="https://media.tenor.com/images/"+h.attr("data-tenor-poster"),y=t('<span class="comment-has-video"><video poster="'+b+'" src="'+f+'" data-tenor-id="'+h.attr("data-tenor-id")+'" data-tenor-gif="'+h.attr("data-tenor-gif")+'" data-tenor-preview="'+h.attr("data-tenor-preview")+'" loop muted webkit-playsinline playsinline'+(o?"":' autoplay="autoplay"')+"></video></span>");d.children(".comment-image-tenor").removeClass("hidden"),o||y.children("video").one("play",function(e){t(this).parent(".comment-has-video").addClass("play").removeClass("auto-play")}).parent(".comment-has-video").addClass("auto-play"),h.parent("a").replaceWith(y)}else f=o?"https://media.tenor.com/images/"+h.attr("data-tenor-preview"):"https://media.tenor.com/images/"+h.attr("data-tenor-gif")+"/tenor.gif",h.one("load",function(t){d.children(".comment-image-tenor").removeClass("hidden")});else(I=h.parent('a[data-animate="1"]')).length&&(C=!0,f=o?I.attr("href").replace(/\/i(\d+.gif)$/i,"/r$1"):I.attr("href"));if(o&&C&&d.parent("p").addClass("comment-image-animate"),v&&a||h.attr("src",f).removeAttr("data-src"),o&&C&&(!v||!a)){var I=h.parent("a");v?I.replaceWith(t('<span class="comment-has-gif" data-href="'+I.attr("href")+'"></span>').append(h)):I.addClass("comment-has-gif")}}}else{var w;if((w=d.find(".comment-has-video:not(.alt-poster)")).length){y=w.find("video");var S=w.data("poster");y.get(0).pause(),o&&i||(S||(S=t('<img src="'+y.attr("poster")+'" alt="">'),w.data("video",y)),y.replaceWith(S)),w.addClass("alt-poster")}}})}},videoControl:function(e){var n=t(this).children("video").get(0);n&&(n.paused?(n.play(),t(this).addClass("play")):(n.pause(),t(this).removeClass("play")))},gifPlay:function(e){return t("img",this).attr("src",t(this).addClass("play").attr(t(this).is("a")?"href":"data-href")),!1}},d=function(){if(!n){var e=document.createElement("video");a=!!e.canPlayType&&!!e.canPlayType("video/mp4")&&!document.documentMode,o=t(document.body).hasClass("mobile"),i=/firefox/i.test(navigator.userAgent)||"undefined"!=typeof InstallTrigger,t(document).ready(function(){var e=t("#IGCCS");e.on("submit",".IGCCS-write form",s.write),e.on("click",".number button.cmt-btn",s.vote),e.on("click",".doc > button.btn_toggle",s.fold),e.on("click",".quotation-source button.btn_toggle",s.foldQuote),e.on("click",'[data-comment-action="translate"]',s.googleTranslate),e.on("click",'[data-comment-action="delete"],[data-comment-action="blind"]',s.state),e.on("click","button.view-blind-comment",s.showBlind),e.on("click",".best_list .doc",s.commentScroll),e.on("click","div.content-translate button.translate-suggest-nickname",s.translateView),e.on("click",".IGCCS-mobile-controll-btn",s.mobileControl),e.on("click",".comment-has-video",s.videoControl),e.on("click",".comment-has-gif:not(.play)",s.gifPlay),s.moreButton=e.find("div.comment-load-more > a").on("click",s.more),s.sortButtons=t("#IGCCS .IGCCS-filter-count .filter button").on("click",s.sort),r=s.sortButtons.filter(".act").text().toLowerCase(),t("#IGCCS-modal-report").find("button.cmt-btn_submit").on("click",s.reportComment),t("#IGCCS-modal-trans-suggestion").find("button.cmt-btn_submit").on("click",s.translateSuggestion),t("#IGCCS-modal-trans-suggestion").find("button.cmt-btn-delete").click(s.suggestionDelete),t(".IGCCS-comment_best .title button.btn_toggle").click(function(e){t(".IGCCS-comment_best").toggleClass("cmt-close")}),t("#IGCCS-modal-insert-image").find("button.cmt-btn_img.select-image").on("click",s.myImages),e.find("div.doc > div.IGCCS-content > blockquote.quote > span.quotation-source").append('<button class="btn_toggle"></button>'),t("#IGCCS-vs-team").change(s.vsTeamSelect),s.listLading=t("<div/>",{class:"IGCCS-loading"}).insertAfter(e.find(".IGCCS-filter-count")),s.addLazyLoadingTarget(e.find(".best_list li[id], .comment_list li[id]"));var n=null;t(window).scroll(function(t){n&&(clearTimeout(n),n=null),n=setTimeout(function(){s.lazyLoading(),n=null},10)}),s.lazyLoading()}),n=!0}};d.prototype={init:function(e,n,a){if(!s.init){if((e=parseInt(e,10))<1||(n=parseInt(n,10))<1||(a=parseInt(a,10))<1)return void alert("[cmt-init] Wrong Access!");s.target1=e,s.target2=n,s.target3=a,s._token=t('head > meta[name="_token"]').attr("content"),s.init=!0}},setEditor:function(t){s.editor=t},getMySuggestion:function(t,e,n){s.mySuggestion(t,e,n)},auth:function(){return IGCCS_COMMENT_AUTH||(location.href="/comments/auth"),IGCCS_COMMENT_AUTH}},INVEN.IGCCS=new d}(jQuery)),"function"!=typeof window.CommentEditor)var CommentEditor=function(t){var e=[],n=0,a=navigator.userAgent,o=/MSIE|Trident/i.test(a);if(o){var i=/MSIE (\d+[.]\d+)/.exec(a);i&&parseFloat(i[1]),(i=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(a))&&parseFloat(i[1])}var r=/Edge\/\d+/.test(a),s=!r&&/firefox/i.test(a)||"undefined"!=typeof InstallTrigger,d=/\r\n|\n/g,l={quotation:{func:function(t){return function(e){INVEN.IGCCS.auth()&&(h.getActiveEditor().saveRange(),h.setActiveEditor(t),h.getModal("quotation").triggerHandler("comment.modal.show"))}},html:'<button type="button" class="btn_add_quote" data-editor-addon="quotation"><img src="https://static.invenglobal.com/img/common/comments/add_quotation.png?v=20200226" srcset="https://static.invenglobal.com/img/common/comments/add_quotation_2x.png?v=20200226 1.3x" height="33"></button>'},insertImage:{func:function(t){return function(e){INVEN.IGCCS.auth()&&(h.setActiveEditor(t),h.getModal("insertImage").triggerHandler("comment.modal.show"))}},html:'<button type="button" class="btn_add_img" data-editor-addon="insertImage"><img src="https://static.invenglobal.com/img/common/comments/insert_image.png?v=20200226" alt="insert image" srcset="https://static.invenglobal.com/img/common/comments/insert_image_2x.png?v=20200226 1.3x" height="33"></button>'},insertGif:{func:function(t){return function(e){INVEN.IGCCS.auth()&&(h.setActiveEditor(t),INVEN.GIF.toggle(e,function(t){h.getActiveEditor().insertImage(t)}))}},html:'<button type="button" class="btn_add_img" data-editor-addon="insertGif"><img src="https://static.invenglobal.com/img/common/tenor/icon_tenor.png?v=20190227e" alt="insert gif" srcset="https://static.invenglobal.com/img/common/tenor/icon_tenor.png_2x.png 1.3x" height="33"></button>'}},c={quotation:function(e){return function(n){return t.summernote.ui.button({contents:'<img src="https://static.invenglobal.com/img/common/comments/btn_addquote.jpg">',tooltip:"Quotation",click:function(t){h.getActiveEditor().saveRange(),h.setActiveEditor(e),h.getModal("quotation").triggerHandler("comment.modal.show")}}).render()}},insertImage:function(e){return function(n){return t.summernote.ui.button({contents:'<img src="https://static.invenglobal.com/img/common/comments/btn_addimg.jpg">',tooltip:"Upload Image",click:function(t){h.setActiveEditor(e),h.getModal("insertImage").triggerHandler("comment.modal.show")}}).render()}}},m={};t.fn.modal=t.noop,t.summernote.options.modules.handle=t.noop,t.summernote.options.modules.autoLink=t.noop,o&&document.execCommand("AutoUrlDetect",!1,!1);var g=t.summernote.options.modules.clipboard;t.summernote.options.modules.clipboard=function(e){var n=new g(e),a=n.pasteByHook;return n.pasteByHook=function(){var t=function(t){return t.replace(d,"").replace(/<\/p>|<br[^>]*>/g,"$&\r\n").replace(/<img[^>]+alt=(['"])?([^>'"]*)\1?[^>]*>/g,"$&$2")}(this.$paste.html()),e=this.$paste.html(t).text();this.$paste.html(e.replace(/[<>]/g,function(t){return"<"==t?"\t&lt;":"\t&gt;"}).replace(d,"<br>")),a.call(this)},n.pasteByEvent=t.noop,n};var u=t.summernote.options.modules.placeholder;function h(n){var a={type:1,html:!1,submitURL:"",myImageListURL:"",invalidTag:"img,script,form,iframe",onInit:t.noop,onFocus:t.noop,onSubmit:t.noop,validation:t.noop,placeholder:"Write your opinion.",quotationPlaceholder:"leave a quotation comment",focus:!1,htmlOptions:{height:null,focus:!1,dialogsInBody:!1,shortcuts:!1,disableDragAndDrop:!0,disableResizeImage:!0,popover:{},toolbar:[["style",["bold","italic","underline","clear"]],["fontsize",["fontsize"]]],fontSizes:["11","12","14","16","20"],minHeight:83,maxHeight:250}};if(t.extend(this,a,n),!this.$container||this.$container.find("form,textarea").length<2)throw"missing options";this.html||(this.html=!0,this.htmlOptions.toolbar=[]),this.$form=this.$container.find("form"),this.$editor=this.$container.find("textarea"),this.$baseEditor=this.$editor.clone(),this.id=e.push(this)-1,this.isSaveRange=!1,this.lastRange=rangy.getSelection().saveRanges(),this.qouteCount=0,this.pasteCount=0,this.init()}return t.summernote.options.modules.placeholder=function(t){var e=new u(t);return e.events={"summernote.init summernote.blur":function(){e.update()},"summernote.focus":function(){e.$placeholder.toggle(!1)}},e},h.create=function(e,n,a){(a=t.extend({name:"comment",class:""},a||{})).$container=t("<div/>",{class:"IGCCS-write IGCCS-comment_write"});var o=t("<form/>",{method:"post",enctype:"multipart/form-data"}),i=t("<textarea/>",{name:a.name,class:a.class}).val(t.trim(e)),r=t("<input/>",{type:"hidden",name:"image_src"}),s=t("<input/>",{type:"hidden",name:"image_pos"});if(o.append(r).append(s).append(t("<div/>",{class:"textarea"}).append(i)),!a.html&&t.isArray(a.addon)){for(var d=t("<div/>",{class:"IGCCS-editor-btns"}),c=0,m=a.addon.length;c<m;c++)d.append(l[a.addon[c]].html);d.append('<button type="submit" class="btn_submit verdana"><span>POST</span></button>'),d.appendTo(o)}return a.$container.append(o),n.$ele[n.pos](a.$container),new h(a)},h.getActiveEditor=function(){return e[n]?e[n]:e[n=0]},h.setActiveEditor=function(t){return n=t,this},h.cleanup=function(){for(var t=0,n=e.length;t<n;t++)e[t]&&1!=e[t].type&&e[t].destroy(!0)},h.toggle=function(n,a){n=t.isArray(n)?n:[],a=t.isArray(a)?a:[];for(var o=0,i=e.length;o<i;o++)e[o]&&(-1!=n.indexOf(e[o].type)||-1!=a.indexOf(o)?e[o].$container.show():e[o].$container.hide());return this},h.setModal=function(t,e){m[t]=e,e.find("form").submit(function(t){return e.triggerHandler("comment.modal.submit"),!1})},h.getModal=function(t){return m[t]},h.htmlFromSelection=function(e){var n=rangy.getSelection();if(!n.rangeCount||n.isCollapsed)return{type:"all",html:e.innerHTML};var a=n.getRangeAt(0);a.containsNode(e,!0)||(a.selectNodeContents(e),a.refresh());var o=rangy.createRange();o.selectNodeContents(e);var i=1==(a=a.intersection(o)).startContainer.nodeType?a.startContainer:a.startContainer.parentNode,r=1==a.endContainer.nodeType?a.endContainer:a.endContainer.parentNode,s=t(i).closest("blockquote"),d=t(r).closest("blockquote");if(s.length&&(i=s.get(0)),d.length&&(r=d.get(0)),t(i).is("blockquote")&&t(r).is("blockquote"))t(i).closest(r).length?i=r:t(r).closest(i).length&&(r=i);else if(t(i).is("blockquote")){(l=t(i).parentsUntil(".IGCCS-content","blockquote")).length&&(i=l.get(l.length-1))}else if(t(r).is("blockquote")){var l;(l=t(r).parentsUntil(".IGCCS-content","blockquote")).length&&(r=l.get(l.length-1))}"blockquote"==i.nodeName.toLowerCase()&&a.setStartBefore(i),"blockquote"==r.nodeName.toLowerCase()&&a.setEndAfter(r);var c={type:"partial",html:t(i).is("blockquote")&&t(i).is(r)?i.innerHTML:a.toHtml()};return n.detach(),c},h.createQuote=function(t,e,n,a){var i="",r=/^(https?:\/\/)(www\.)?.+/i.test(e);return a=a?'<span class="quote-time">- '+a+"</span>":"",i+='<blockquote contenteditable="false" class="'+(o?"msie ":"")+'quote" cite="">',i+=t=t.replace(/<span class="time"[^>]*>.+<\/span>/i,""),i+=r?'<span class="quotation-source">source : '+e+"<br>"+a+"</span>":e&&!n?'<span class="quotation-source">source : '+e+a+"</span>":e&&n?'<span class="quotation-source"><a href="#'+e+'"><span>'+n+"</span></a>"+a+"</span>":'<span class="quotation-source"></span>',i+="</blockquote>"},h.prototype.init=function(){var e=this;this.applyAddon(),this.$editor.attr("placeholder",this.placeholder),this.html?(this.htmlOptions.focus=this.focus,this.htmlOptions.placeholder=this.placeholder,this.$editor.summernote(this.htmlOptions),o||this.$editor.on("summernote.paste",t.proxy(function(e,n){var a;n.stopPropagation(),n.preventDefault(),(a=(n.originalEvent.clipboardData||window.clipboardData).getData("text/plain"))&&(-1===a.indexOf("\n")?this.$editor.summernote("insertText",a):this.$editor.summernote("insertNode",t("<span/>").html(a.replace(/[<>]/g,function(t){return"<"==t?"\t&lt;":"\t&gt;"}).replace(d,"<br>"))[0]))},this)),this.$editor.on("summernote.focus",t.proxy(function(e,n){if(!INVEN.IGCCS.auth())return t(n.target).blur(),!1;this.onFocus(),this.constructor.setActiveEditor(this.id)},this)),o||this.$editor.on("summernote.blur",t.proxy(function(t){this.saveRange()},this)),(o||r||s)&&this.$editor.data("summernote").layoutInfo.editable.on("click keydown",t.proxy(function(e){var n=e.which||e.keyCode,a=rangy.getSelection(),i=a.getRangeAt(0),d=r||s||n>=37&&n<=40;if(this.qouteCount){if(!r&&46==n&&(1==i.endContainer.nodeType||i.endOffset==i.endContainer.length)){var l=3==i.endContainer.nodeType?i.endContainer.parentNode:i.endContainer;if((c=t(l).next("blockquote")).length)return c.remove(),!1}if(8==n&&(1==i.startContainer.nodeType||0==i.startOffset)){var c;l=3==i.startContainer.nodeType?i.startContainer.parentNode:i.endContainer;if((c=t(l).prev("blockquote")).length){if(s)return c.hide().remove(),!0;if(r){if(1==i.startContainer.nodeType&&t(l).text())return!0;var m=c.get(0).previousSibling;m&&!t(m).is("blockquote")&&a.collapse(m,m.childNodes.length)}return c.remove(),!1}}if(!d){var g=t(i.startContainer.parentNode).closest("blockquote"),u=t(i.endContainer.parentNode).closest("blockquote");if(g.length||u.length)return!1}}o&&setTimeout(t.proxy(function(){this.saveRange()},this),0),a.detach()},this)),this.$editor.on("summernote.init",t.proxy(this.onInit,this))):(this.$editor.focus(t.proxy(function(t){this.constructor.setActiveEditor(this.id)},this)),this.onInit()),this.$container.on("click",".cmt-image-close",function(n){t(this).parent().remove(),e.$form.find('[name="image_src"],[name="image_pos"]').val("").end().find('[name="image"]').remove()}),this.$form.submit(t.proxy(function(t){if(t.preventDefault(),!INVEN.IGCCS.auth())return!1;this.onSubmit()},this)),this.$form.data("editor",this),this.constructor.setActiveEditor(this.id)},h.prototype.destroy=function(t){this.$form.off(),this.html?this.$editor.off().summernote("destroy"):this.$form.find().find("[data-delete],[data-editor-addon]").off(),this.$form.removeData("editor"),t&&this.$container.remove(),delete e[this.id]},h.prototype.applyfocus=function(){this.$editor.summernote("focus")},h.prototype.getComment=function(){if(this.html)return this.$editor.summernote("code");var e="";return this.$form.find('[name="'+this.$baseEditor.attr("name")+'"]').each(function(n,a){e+=t(this).val()}),e},h.prototype.sync=function(){if(this.html){s&&this.qouteCount&&this.$editor.data("summernote").layoutInfo.editable.find("blockquote:hidden").remove();var t=this.$editor.summernote("code");this.$editor.summernote("code",t)}},h.prototype.empty=function(t){this.$container.children(".cmt-image").remove(),this.$form.find('[name="image_src"]').val(""),this.$form.find('[type="file"][name="image"]').remove(),this.html&&this.$editor.summernote("code","")},h.prototype.isEmpty=function(e){var n=!1;return this.html?!(this.$form.find('[name="image_src"]').val()||this.$form.find('[name="image"]').length||t.trim(this.$editor.data("summernote").layoutInfo.editable.text())):(e?this.$form.find('[data-quotation][name="'+this.$baseEditor.attr("name")+'"]').each(function(e,a){if(""==t.trim(t(this).val()))return this.$emptyEditor=t(this),n=!0}):n=""==this.$editor.val(),n)},h.prototype.insertQuotation=function(e,n,a,o){if(this.html){if(this.restoreRange(),"all"==o?(e.find("[data-lightbox]").each(function(e,n){t(this).attr("data-lightbox","cmt-image-"+Date.now()+e)}),e.find(".comment-has-video").each(function(e,n){t(this).children("video").is("[autoplay]")||t(this).removeClass("play")})):e.find("img").remove(),e.find(".btn_toggle").remove(),e.find(".quotation-source").each(function(e,n){t(this).next(".quotation-source").remove()}),s||r)var i=rangy.getSelection();this.$editor.summernote("insertNode",e.get(0)),c=this.$container,m=t(window).scrollTop(),g=m+t(window).height(),!((u=c.offset().top)+c.height()<=g&&u>=m)&&this.$container.get(0).scrollIntoView(),(s||r)&&i.collapse(e.get(0).nextSibling)}else{var d=t("<input/>",{type:"hidden",name:this.$baseEditor.attr("name"),value:e.get(0).outerHTML}),l=this.$baseEditor.clone();e.append(d).append('<button type="button" data-delete>abort</button>').append(l.attr({"data-quotation":!0,placeholder:this.quotationPlaceholder})),n.$ele[n.pos](e),e.find("[data-delete]").one("click",function(t){e.remove()}),a&&l.focus()}var c,m,g,u;this.qouteCount++},h.prototype.saveRange=function(){this.html&&(this.lastRange=rangy.getSelection().saveRanges())},h.prototype.saveRangeOnce=function(){this.isSaveRange||(this.saveRange(),this.isSaveRange=!0)},h.prototype.restoreRange=function(){this.html&&(rangy.getSelection().restoreRanges(this.lastRange),this.isSaveRange=!1)},h.prototype.getImage=function(e){var n="";return t(e).is("a")?n=t(e).attr("href"):t(e).is("figure")?n=t(e).attr("data-gif"):e.files.length&&(n=URL.createObjectURL(e.files[0]),setTimeout(function(){URL.revokeObjectURL(n)},0)),n},h.prototype.insertImage=function(e,n){var a=this.getImage(e),o=!1,i=!1;this.$container.children(".cmt-image").remove(),this.$form.find('[name="image_src"]').val(""),this.$form.find('[type="file"][name="image"]').remove(),t(e).is("a")?(this.$form.find('[name="image_src"]').val(t(e).attr("data-image")),o=/.gif$/i.test(a)):t(e).is("figure")?(this.$form.find('[name="image_src"]').val(t(e).attr("data-image-set")),i=o=!0):(t(e).attr("name","image").appendTo(this.$form),o="image/gif"==e.files[0].type),this.$form.find('[name="image_pos"]').val(n||"up");var r='<div class="cmt-image'+(o?" gif":"")+'"><span class="cmt-image-close">image delete</span><img src="'+a+'">'+(i?'<span class="cmt-image-tenor">tenor</span>':"")+"</div>";this.$container["down"==n?"append":"prepend"](r)},h.prototype.applyAddon=function(){if(this.html&&this.htmlOptions.toolbar.length){if(t.isArray(this.addon)){for(var e=["custom",[]],n={},a=0,o=this.addon.length;a<o;a++)c[this.addon[a]]&&(e[1].push(this.addon[a]),n[this.addon[a]]=c[this.addon[a]](this.id));e[1].length&&(this.htmlOptions.toolbar.push(e),this.htmlOptions.buttons=n)}}else for(a=0,o=this.addon.length;a<o;a++)this.$form.find("[data-editor-addon="+this.addon[a]+"]").on("click",l[this.addon[a]].func(this.id))},h}(jQuery);jQuery(function(t){rangy.init();var e=null,n=null,a=function(t){return t.replace(/[<>]/g,function(t){return"<"==t?"\t&lt;":"\t&gt;"})},o=t('<div id="IGCCS-popup-bg"></div>').appendTo("body");o.click(function(e){t(this).hide(),t("body").removeClass("lb-disable-scrolling"),t(".IGCCS-pop.act").removeClass("act").triggerHandler("modal.bg.click")}),t(document).on("keyup",function(t){27==t.keyCode&&o.click()});var i=t("#IGCCS-modal-add-quotation");i.on("comment.modal.show",function(e){o.show(),t("body").addClass("lb-disable-scrolling"),t(this).find("input,textarea").val("").end().addClass("act")}).on("comment.modal.hide",function(e){o.hide(),t("body").removeClass("lb-disable-scrolling"),t(this).removeClass("act")}).on("comment.modal.submit",function(e){var n=CommentEditor.getActiveEditor(),i=t("textarea",this),r=t("input",this);if(!t.trim(i.val()))return alert("Please enter your quotation."),void i.focus();var s=t.trim(a(i.val()).replace(/\r\n|\n/g,"<br>")),d=t.trim(a(r.val()));o.hide(),t("body").removeClass("lb-disable-scrolling"),t(this).removeClass("act"),n.insertQuotation(t(CommentEditor.createQuote(s,d,"",moment.tz("America/Los_Angeles").format("YYYY-MM-DD HH:mm:ss"))),{$ele:n.$editor,pos:"before"},!0)}).find(".cmt-btn_close").click(function(e){o.hide(),t("body").removeClass("lb-disable-scrolling"),i.removeClass("act")});var r=t("#IGCCS-modal-insert-image");r.on("comment.modal.show",function(e){o.show(),t("body").addClass("lb-disable-scrolling"),t(this).find(".image-preview").empty().end().addClass("act")}).on("comment.modal.hide",function(e){o.hide(),t("body").removeClass("lb-disable-scrolling"),t(this).removeClass("act")}).on("change",'input[type="file"]',function(e){if(this.files.length){var n=!1;if(0!==this.files[0].type.indexOf("image/")?(alert("Only image files can be uploaded."),n=!0):this.files[0].size>2097152&&(alert("The file size is too large. Must be at most 2MB."),n=!0),!n)return r.triggerHandler("comment.modal.file.change",[this]),!1;t(this).triggerHandler("modal.reset.file")}else r.find("img.preview").remove()}).on("comment.modal.file.change",function(a,o){var i=CommentEditor.getActiveEditor(),r=!1,s="",d=this;o&&"string"==typeof o?t(this).triggerHandler("modal.reset.file"):t(this).find('[name="image_url"]').val(""),(o=i.getImage(o))&&(t(".image-preview",this).html('<img class="preview hidden" src="'+o+'">'),t(".image-preview img",this).on("load",function(){var a=t(this);a.prop("naturalWidth")*a.prop("naturalHeight")>3e7&&(s="The resolution of the image is too large.\nPlease upload after image resize.",r=!0),null!==e&&a.prop("naturalWidth")>e&&(s="The maximum image width is "+e+"px.",r=!0),null!==n&&a.prop("naturalHeight")>n&&(s=r?"The maximum image size is "+e+"px/"+n+"px.":"The maximum image height is "+n+"px.",r=!0),r?(alert(s),t(this).remove(),t(d).triggerHandler("modal.reset.file")):t(this).removeClass("hidden")}))}).on("modal.bg.click",function(e){t(this).triggerHandler("modal.reset.file")}).on("modal.reset.file",function(e){var n=Date.now();return t(this).find('[type="file"]').remove(),t(this).find("label.cmt-btn_img").attr("for",n).end().append(t("<input/>",{id:n,type:"file",class:"hidden",name:"image",accept:"image/*"})),!1}).on("click",".image-preview a[data-image]",function(e){return t(this).hasClass("selected")||(r.find(".image-preview a[data-image]").removeClass("selected"),t(this).addClass("selected")),!1}).find('[name="image_url"]').on("blur paste",function(e){setTimeout(t.proxy(function(t){r.triggerHandler("comment.modal.file.change",[this.value])},this),0)}).on("keypress",function(t){if(t.which,13==t.keyCode)return r.triggerHandler("comment.modal.file.change",[this.value]),!1}).end().on("comment.modal.submit",function(e){var n=CommentEditor.getActiveEditor(),a=r.find('[type="file"]').get(0),i=r.find("a.selected[data-image]"),s=t("#image_position",r).val();return i.length||a.files.length?(n.insertImage(i.length?i:a,s),o.hide(),t("body").removeClass("lb-disable-scrolling"),r.removeClass("act").triggerHandler("modal.reset.file"),!1):(alert("Please upload an image or select an image"),!1)}).find(".cmt-btn_close").click(function(e){o.hide(),t("body").removeClass("lb-disable-scrolling"),r.removeClass("act").triggerHandler("modal.reset.file")});var s=t("#IGCCS-modal-trans-suggestion");s.find(".cmt-btn_close").click(function(e){o.hide(),t("body").removeClass("lb-disable-scrolling"),s.removeClass("act").removeData("cidx")}).end().find('[name="lang"]').change(function(e){t("body").addClass("loading"),INVEN.IGCCS.getMySuggestion(s.data("cidx"),t(this).val(),function(e){s.triggerHandler("update",[e]),t("body").removeClass("loading")})}),s.on("update",function(e,n){t.isEmptyObject(n)?s.find('textarea,[name="idx"]').val("").end().find(".cmt-btn-delete").hide():(s.find('[name="idx"],[name="content"],[name="lang"]').each(function(e,a){t(this).val(n[t(this).attr("name")])}),s.find(".cmt-btn-delete").show())});var d=t("#IGCCS-modal-report");d.find(".cmt-btn_close").click(function(e){o.hide(),t("body").removeClass("lb-disable-scrolling"),d.removeClass("act").removeData("cidx")});var l=t("#IGCCS-modal-captcha");if(l.on("comment.modal.show",function(e,n){l.data({cache:{},captchas:{}}).trigger("comment.captcha.count",n).triggerHandler("comment.captcha.load").done(function(){o.show(),t("body").addClass("lb-disable-scrolling"),l.addClass("act")})}).on("comment.modal.hide",function(e,n){!0!==n&&(o.hide(),t("body").removeClass("lb-disable-scrolling")),t(this).removeClass("act").removeData().find("input").val("").end().find(".cmt-captcha-image").off("error").end().find('button[type="submit"]').text("SUBMIT").end().off("comment.captcha.error comment.modal.submit").one("transitionend",function(t){l.removeClass("show-progress").find(".cmt-captcha-image").attr("src","").end().find(".progress .bar").css("width","")})}).on("modal.bg.click",function(e){t(this).triggerHandler("comment.modal.hide",!0)}).on("comment.captcha.count",function(t,e){var n=Object.keys(l.data("captchas")).length;l.toggleClass("show-progress",e>1).data({count:e,calcProgress:!0}),n&&(e-n>1&&l.find('button[type="submit"]').text("Next Check"),l.triggerHandler("comment.captcha.load"))}).on("comment.captcha.remove",function(t,e,n){var a=l.find('input[name="random"]');delete l.data("captchas")[e],"invalid"==n&&a.val()!=e&&e in l.data("cache")?(a.val(e),l.find(".cmt-captcha-image").attr("src",l.data("cache")[e]).end().find('input[name="captcha_code"]').val("")):"not_found"!=n&&a.val()==e||l.trigger("comment.captcha.load").find('input[name="captcha_code"]').val("")}).on("comment.captcha.reload",function(t){var e=l.find(".cmt-captcha-image"),n=e.attr("src");e.attr("src",n+"&")}).on("comment.captcha.load",function(e){var n=t.Deferred().resolve();if(!l.data("isAjax")){var a=l.find('input[name="random"]');l.data("isAjax",!0),n=t.get("/captcha").done(function(t){if(l.data("calcProgress")){var e=l.data("count");if(e>1){var n=Object.keys(l.data("captchas")).length;l.find(".progress").children(".text").text(n+1+" / "+e).end().children(".bar").css("width",Math.ceil((n+1)/e*100)+"%"),e-n==1?l.find('button[type="submit"]').text("SUBMIT"):0==n&&l.find('button[type="submit"]').text("Next Check"),l.find('input[name="captcha_code"]').val("")}l.removeData("calcProgress")}a.val(t.random),l.find(".cmt-captcha-image").off("error").one("error",function(e){this.src=t.backup_image}).attr("src",t.image)}).fail(function(){l.data("calcProgress",!0).triggerHandler("comment.captcha.error",[l.data("count")>1?"after_verify":a.val()?"change":"load"])}).always(function(){l.removeData("isAjax")})}return n}).on("comment.captcha.verify",function(e){if(!l.data("isAjax")){l.data("isAjax",!0);var n={input:l.find('input[name="captcha_code"]').val(),random:l.find('input[name="random"]').val()};t.get("/captcha/verify",n).done(function(t){l.data("captchas")[n.random]=n.input,l.data("cache")[n.random]=l.find(".cmt-captcha-image").attr("src"),l.removeData("isAjax"),l.data("calcProgress",!0).triggerHandler("comment.captcha.load")}).fail(function(t){alert(t.responseJSON.msg),l.removeData("isAjax"),404==t.status&&l.trigger("comment.captcha.load").find('input[name="captcha_code"]').val("")})}}).find(".buttons button").click(function(e){l.triggerHandler("comment.captcha."+t(this).attr("data-action"))}).end().find(".cmt-btn_close").click(function(t){l.triggerHandler("comment.modal.hide")}).end().find("form").submit(function(t){var e=l.data("captchas"),n=l.data("count"),a=Object.keys(e).length;if(n>1&&n-a>1)l.triggerHandler("comment.captcha.verify");else{var o=l.find('input[name="random"]').val();l.data("cache")[o]=l.find(".cmt-captcha-image").attr("src"),e[o]=l.find('input[name="captcha_code"]').val(),l.triggerHandler("comment.modal.submit",[e])}return!1}),t("#IGCCS").on("click","[data-comment-action]",function(e){var n=t(this),a=n.closest(".doc"),i=n.closest("li[id]").attr("id").match(/\d+$/)[0],r=n.attr("data-comment-action");if("translate"!=r&&!INVEN.IGCCS.auth())return!1;switch(r){case"reply":if(n.data("editor"))n.data("editor").$container.is(":visible")?CommentEditor.toggle([1]).setActiveEditor(u.id):(CommentEditor.toggle([],[0,n.data("editor").id]),n.data("editor").applyfocus());else{var l=CommentEditor.create("",{$ele:a.children(".reply-editor-area"),pos:"append"},{type:2,html:m,focus:!0,addon:g?["quotation","insertImage","insertGif"]:["quotation"]});CommentEditor.toggle([],[0,l.id]),n.data("editor",l)}break;case"quotation":var c=CommentEditor.getActiveEditor(),h=a.children(".IGCCS-content"),p=CommentEditor.htmlFromSelection(h.get(0)),f=n.closest("li").attr("id"),v=a.children(".name").find(".nickname .time[data-date]").attr("data-date"),C=a.children(".name").find(".nickname p")[0],b=1==(C=C.childNodes[C.childNodes.length-1]).nodeType?C.textContent:C.nodeValue;c.insertQuotation(t(CommentEditor.createQuote(p.html,f,t.trim(b),v)),{$ele:c.$editor,pos:"before"},!0,p.type);break;case"trans_suggestion":t("body").addClass("loading"),INVEN.IGCCS.getMySuggestion(i,s.find('[name="lang"]').val(),function(e){s.triggerHandler("update",[e]),o.show(),t("body").addClass("lb-disable-scrolling"),s.data("cidx",i).addClass("act"),t("body").removeClass("loading")});break;case"report":o.show(),t("body").addClass("lb-disable-scrolling"),d.find(":input").val("").end().addClass("act"),d.data("cidx",i);break;case"show_bad_word_list":showBadWordList(n,"/comments/badword/"+i)}}),CommentEditor.setModal("quotation",i),CommentEditor.setModal("insertImage",r),t(".IGCCS-write").length)var c=t(".IGCCS-write form"),m="html"==c.attr("data-editor-mode"),g="Y"==c.attr("data-image-allow"),u=new CommentEditor({html:m,$container:t(".IGCCS-write"),addon:["quotation","insertImage","insertGif"]});"object"==typeof INVEN&&INVEN.hasOwnProperty("IGCCS")&&"function"==typeof INVEN.IGCCS.setEditor&&INVEN.IGCCS.setEditor(CommentEditor)});
